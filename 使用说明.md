# 仪器预约系统 - 使用说明

## 🎉 系统已成功启动！

### 访问地址
- **主页面**: http://localhost:5011
- **登录页面**: http://localhost:5011/login.html
- **预约页面**: http://localhost:5011/reserve
- **管理后台**: http://localhost:5011/admin.html

## 🚀 快速开始

### 1. 首次使用
1. 打开浏览器访问 http://localhost:5011
2. 系统会自动重定向到登录页面
3. 点击"飞书扫码登录"按钮
4. 使用飞书扫码完成登录
5. 系统会自动注册您的账户并跳转到预约页面

### 2. 预约仪器
1. 在预约页面选择要预约的仪器
2. 在时间网格中点击选择预约时间
3. 点击"创建预约"按钮
4. 预约成功！

### 3. 管理功能（管理员/超级管理员）
1. 访问 http://localhost:5011/admin.html
2. 可以管理用户信息、设置角色
3. 可以审批预约、管理仪器设置

## 🔧 权限说明

### 普通用户 (user)
- ✅ 查看仪器列表
- ✅ 预约仪器
- ✅ 查看自己的预约
- ✅ 取消自己的预约

### 管理员 (manager)
- ✅ 普通用户的所有权限
- ✅ 访问管理后台
- ✅ 编辑用户信息
- ✅ 审批预约
- ✅ 管理仪器设置

### 超级管理员 (admin)
- ✅ 管理员的所有权限
- ✅ 设置用户角色
- ✅ 删除用户
- ✅ 管理所有预约

## 📱 二维码功能

### 生成仪器二维码
访问以下URL可以生成任意仪器的二维码：
```
http://localhost:5011/api/instruments/{仪器ID}/qrcode
```

例如：`http://localhost:5011/api/instruments/1/qrcode`

### 扫码预约
1. 扫描仪器二维码
2. 自动跳转到该仪器的预约页面
3. 自动完成登录（如果未登录）
4. 直接开始预约

## 🛠️ 故障排除

### 常见问题

1. **登录失败 - redirect_uri 请求不合法**
   - 这是飞书OAuth配置问题，已修复
   - 如果仍有问题，请检查飞书应用的回调URL设置

2. **权限不足**
   - 确认用户角色设置正确
   - 联系超级管理员提升权限

3. **无法访问管理后台**
   - 只有管理员和超级管理员可以访问
   - 普通用户会看到权限不足提示

### 调试模式
如果需要查看详细日志，可以设置环境变量：
```bash
export SQLALCHEMY_ECHO=1
python app.py
```

## 📞 技术支持

系统已完全配置好，包含：
- ✅ 三级权限系统
- ✅ 飞书OAuth登录
- ✅ 仪器二维码功能
- ✅ 自动注册功能
- ✅ 权限管理

如有问题，请检查：
1. 服务是否正常运行（http://localhost:5011/api/health）
2. 浏览器控制台是否有错误
3. 网络连接是否正常

## 🎯 下一步

1. **配置飞书应用**：在飞书开放平台配置回调URL为 `http://localhost:5011/api/auth/feishu/callback`
2. **设置第一个超级管理员**：首次登录的用户默认为普通用户，需要手动提升权限
3. **添加仪器数据**：通过管理后台添加仪器信息
4. **生成二维码**：为每台仪器生成预约二维码并打印张贴

系统现在完全可以使用了！🎉
